# set -g  = set-option (for global session)
# setw -g = set-window-option (for global window)
# three objects: server -< session -< window

# All tmux commands are activated with the prefix Ctrl-o now
set -g prefix C-o		# use ctrl-o as our <leader>
bind C-o send-prefix	# pass ctrl-o down to other apps
unbind-key C-b			# free up ctrl-b now

## Global preferences

set -sg escape-time 0
set -g  base-index 1                       # start window numbering at 1 (since 0 is on wrong side of keyboard)
set -g  allow-rename off                   # don't let tmux rename our windows in the status bar
set -g  bell-action any                    # listen to alerts from all windows
set -g  default-terminal "screen-256color" # might not need this

#####################
# random key bindings
#####################
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R

## These don't seem to work any more

# iTerm | Profiles > Keys, set left/right [meta] key to Meta
# switch panes using Alt-arrow without prefix
# bind -n M-Left select-pane -L
# bind -n M-Right select-pane -R
# bind -n M-Up select-pane -U
# bind -n M-Down select-pane -D
# bind -n M-h select-pane -L
# bind -n M-l select-pane -R
# bind -n M-j select-pane -D
# bind -n M-k select-pane -U
# bind -n M-o select-pane -t :.+
# bind -n ] select-pane -t :.+
# bind -n [ select-pane -t :.-

# force a reload of the config file
unbind r
bind r source-file ~/.tmux.conf \; display "Reloaded"

# Rebind pane tiling to sane mnemonics and start 
# new window in same directory from where you are now.

bind v   split-window -h -c "#{pane_current_path}"
bind s   split-window -c "#{pane_current_path}"
bind |   split-window -h -c "#{pane_current_path}"
bind -   split-window -v -c "#{pane_current_path}"
bind '"' split-window -c "#{pane_current_path}"
bind %   split-window -h -c "#{pane_current_path}"

# pane resizing
bind H resize-pane -L 5
bind J resize-pane -D 5
bind K resize-pane -U 5
bind L resize-pane -R 5

bind < resize-pane -L 5
bind + resize-pane -D 5
bind - resize-pane -U 5
bind > resize-pane -R 5

# quick pane cycling (ctrl-o twice quickly)
unbind ^O
bind ^O select-pane -t :.+

# Fix clear screen
bind C-l send-keys 'C-l'

# Fix yank
bind C-k send-keys 'C-k'

# Mouse Mode Settings
set -g mouse on


# Restore tmux 2.0 mouse wheel behavior 
# bind-key -T root WheelUpPane if-shell -F -t = "#{alternate_on}" "send-keys -M" "select-pane -t =; copy-mode -e; send-keys -M"
# bind-key -T root WheelDownPane if-shell -F -t = "#{alternate_on}" "send-keys -M" "select-pane -t =; send-keys -M"

setw -g window-status-bell-style fg=white,bg=red #base2, red
# setw -qg window-status-format "#I #W"
# setw -qg window-status-current-format "#I•#W"
bind '-' setw window-status-format '#I'\; setw window-status-current-format '#I'
bind '+' setw window-status-format '#I:#W#F'\; setw window-status-current-format '#I:#W#F'

# pane number display
set -g display-panes-active-colour blue #blue
set -g display-panes-colour brightred #orange

# clock
set-window-option -g clock-mode-colour green #green

# Status bar custom
tm_icon=♠			# spades
tm_icon=☃			# unicode snowman for you
tm_icon=ಠ_ಠ			# disapproving ascii
tm_icon=→ 
set -g status-left "$tm_icon #S  "
set -g status-interval 5

# special symbols
#H    Hostname of local host
#h    Hostname of local host without the domain name
#F    Current window flag
#I    Current window index
#S    Session name
#W    Current window name
#(shell-command)  First line of the command's output
#string will be passed through strftime(3) before being used.

#set -g status-left '#{?client_prefix,#[fg=colour254]#[bg=colour31]#[bold],#[fg=colour16]#[bg=colour254]#[bold]} #S #{?client_prefix,#[fg=colour31]#[bg=colour234]#[nobold],#[fg=colour254]#[bg=colour234]#[nobold]}#(eval $POWERLINE_COMMAND tmux left)'


######################################
# Clipboard with VIM support in iterm2 P
# https://evertpot.com/osx-tmux-vim-copy-paste-clipboard/
######################################

# brew install reattach-to-user-namespace: allows tmux to use clipboard
set -g default-shell $SHELL
set -g default-command "reattach-to-user-namespace -l ${SHELL}"

# Setup 'v' to begin selection as in Vim
# Changes in newer version of tmux 2.5
# https://github.com/tmux/tmux/issues/754

setw -g mode-keys vi

# bind-key -T copy-mode-vi v send-keys -X begin-selection
# bind-key -T copy-mode-vi y send-keys -X copy-pipe "reattach-to-user-namespace pbcopy"

bind-key -T edit-mode-vi Up send-keys -X history-up
bind-key -T edit-mode-vi Down send-keys -X history-down

unbind-key -T copy-mode-vi Space     ;   bind-key -T copy-mode-vi v send-keys -X begin-selection
unbind-key -T copy-mode-vi [         ;   bind-key -T copy-mode-vi [ send-keys -X begin-selection
unbind-key -T copy-mode-vi C-v       ;   bind-key -T copy-mode-vi C-v send-keys -X rectangle-toggle
unbind-key -T copy-mode-vi ]         ;   bind-key -T copy-mode-vi ] send-keys -X copy-selection
unbind-key -T copy-mode-vi Enter     ;   bind-key -T copy-mode-vi y send-keys -X copy-pipe-and-cancel "reattach-to-user-namespace pbcopy"

# Update default binding of `Enter` to also use copy-pipe
#
# BUG: this doesn't work on most recent tmux
# unbind -t vi-copy Enter
# bind-key -t vi-copy Enter copy-pipe "reattach-to-user-namespace pbcopy"

# Bind the tmux ']' to use pbpaste
bind ] run "reattach-to-user-namespace pbpaste | tmux load-buffer - && tmux paste-buffer"

# /Users/scott/.tmux.conf:110: invalid or unknown command: bind-key -t vi-copy PPage page-up                                  
# /Users/scott/.tmux.conf:111: invalid or unknown command: bind-key -t vi-copy NPage page-down                                     
# /Users/scott/.tmux.conf:200: invalid or unknown command: bind-key -t vi-copy v begin-selection                                   
# /Users/scott/.tmux.conf:201: invalid or unknown command: bind-key -t vi-copy y copy-pipe "reattach-to-user-namespace pbcopy"     
# /Users/scott/.tmux.conf:204: invalid or unknown command: unbind -t vi-copy Enter                                                 
# /Users/scott/.tmux.conf:205: invalid or unknown command: bind-key -t vi-copy Enter copy-pipe "reattach-to-user-namespace pbcopy" 

# if-shell "test -f ~/.tmux.snapshot" "source ~/.tmux.snapshot"
# Contents of ~/.tmux.snapshot

# This tmux statusbar config was created by tmuxline.vim
# on Tue, 23 Jan 2018

set -g status-justify "left"
set -g status "on"
set -g status-attr "none"
set -g message-command-bg "colour240"
set -g status-left-length "100"
set -g pane-active-border-fg "colour148"
set -g status-bg "colour236"
set -g message-command-fg "colour231"
set -g pane-border-fg "colour240"
set -g message-bg "colour240"
set -g status-left-attr "none"
set -g status-right-attr "none"
set -g status-right-length "100"
set -g message-fg "colour231"
setw -g window-status-fg "colour245"
setw -g window-status-attr "none"
setw -g window-status-activity-bg "colour236"
setw -g window-status-activity-attr "none"
setw -g window-status-activity-fg "colour148"
setw -g window-status-separator ""
setw -g window-status-bg "colour236"
set -g status-left "#[fg=colour22,bg=colour148,bold] #S #[fg=colour148,bg=colour236,nobold,nounderscore,noitalics]"
set -g status-right "#[fg=colour240,bg=colour236,nobold,nounderscore,noitalics]#[fg=colour250,bg=colour240] %a %b %e #[fg=colour252,bg=colour240,nobold,nounderscore,noitalics]#[fg=colour241,bg=colour252] %-l:%M %p "
setw -g window-status-format "#[fg=colour236,bg=colour236,nobold,nounderscore,noitalics]#[default] #I #W #[fg=colour236,bg=colour236,nobold,nounderscore,noitalics]"
setw -g window-status-current-format "#[fg=colour236,bg=colour240,nobold,nounderscore,noitalics]#[fg=colour231,bg=colour240] #I #W #[fg=colour240,bg=colour236,nobold,nounderscore,noitalics]"

